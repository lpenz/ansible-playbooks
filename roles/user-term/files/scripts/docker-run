#!/bin/bash

NAME="${PWD##*/}"
NAME="${NAME,,}"

TMP=$(mktemp)
trap 'rm -f $TMP' EXIT

CMD=( docker run -it --rm -P -v "$PWD:/home/user/work" -e "MY_UID=$UID" --name "$NAME" "$NAME" "$@" )

if grep -q '^# docker run ' Dockerfile; then
    sed -n 's@^# \(docker run .*\)$@\1@p' Dockerfile | head -1 > "$TMP"
    CMD=( $(cat "$TMP") )
fi

set -x -e

/bin/bash -c "${CMD[*]} $*"

